{"version":3,"file":"BuildingsOSM.js","sourceRoot":"","sources":["../src/BuildingsOSM.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,SAAS,EAAE,MAAM,YAAY,CAAC;AAEvC,OAAO,EAAE,mBAAmB,EAAE,MAAM,aAAa,CAAC;AAIlD,OAAO,SAAS,MAAM,aAAa,CAAC;AAEpC,MAAM,CAAC,OAAO,OAAO,YAAa,SAAQ,SAAS;IAI/C,YAAY,OAAgB;QACxB,KAAK,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QAJlB,cAAS,GAAG,CAAC,CAAC;QACf,gBAAW,GAAW,EAAE,CAAC,CAAC,iDAAiD;QAY1E,uBAAkB,GAAa;YACnC,sCAAsC,EAAE,iDAAiD;YACzF,sCAAsC;YACtC,sCAAsC;YACtC,sCAAsC;YAEtC,wDAAwD;YACxD,wDAAwD;YACxD,wDAAwD;YACxD,uDAAuD;SAC1D,CAAC;IAlBF,CAAC;IAEe,iBAAiB;QAC7B,KAAK,CAAC,iBAAiB,EAAE,CAAC;QAE1B,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC;IACvD,CAAC;IAckB,eAAe,CAAC,QAAgB;QAC/C,MAAM,YAAY,GAAC,EAAE,CAAC,CAAC,IAAI;QAC3B,MAAM,QAAQ,GAAG,QAAQ,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC;QAC9C,8CAA8C;QAC9C,OAAO,QAAQ,CAAC;IACpB,CAAC;IAEM,qBAAqB,CAAC,IAAU;QACnC,IAAI,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC;YACzB,OAAO,CAAC,KAAK,CAAC,IAAI,CAAC,UAAU,EAAE,GAAG,iBAAiB,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,sDAAsD,CAAC,CAAC;YAClI,OAAO;QACX,CAAC;QAED,MAAM,YAAY,GAAG,IAAI,CAAC,UAAU,CAAC,KAAK,EAAE,CAAC;QAE7C,MAAM,GAAG,GAAG,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,YAAY,CAAC,CAAC,GAAG,GAAG,GAAG,YAAY,CAAC,CAAC,GAAG,GAAG,GAAG,YAAY,CAAC,CAAC,GAAG,OAAO,GAAC,SAAS,GAAC,IAAI,CAAC,WAAW,CAAC;QACxJ,IAAI,CAAC,SAAS,GAAG,CAAC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,kBAAkB,CAAC,MAAM,CAAC,CAAC,0CAA0C;QAElH,MAAM,OAAO,GAAoB;YAC7B,WAAW,EAAE,mBAAmB,CAAC,QAAQ;YACzC,IAAI,EAAE,IAAI;YACV,UAAU,EAAE,YAAY;YACxB,QAAQ,EAAE,SAAS,CAAC,SAAS;YAC7B,GAAG,EAAE,GAAG;YACR,UAAU,EAAE,KAAK;YACjB,WAAW,EAAE,IAAI;SACpB,CAAA;QACD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;IACxC,CAAC;CACJ","sourcesContent":["import { EPSG_Type } from \"./TileMath\";\r\nimport { BuildingRequest } from \"./Buildings\";\r\nimport { BuildingRequestType } from \"./Buildings\";\r\n\r\nimport Tile from \"./Tile\";\r\nimport TileSet from \"./TileSet\";\r\nimport Buildings from \"./Buildings\";\r\n\r\nexport default class BuildingsOSM extends Buildings {\r\n    private serverNum = 0;\r\n    public accessToken: string = \"\"; //new for 2024 osmbuildings seem to now be onegeo\r\n\r\n    constructor(tileSet: TileSet) {\r\n        super(\"OSM\", tileSet);\r\n    }\r\n\r\n    public override generateBuildings() {\r\n        super.generateBuildings();\r\n\r\n        this.tileSet.ourAttribution.addAttribution(\"OSMB\");\r\n    }\r\n\r\n    private osmBuildingServers: string[] = [\r\n        \"https://a-data.onegeo.co/maps/tiles/\", //new for 2024 osmbuildings seem to now be onegeo\r\n        \"https://b-data.onegeo.co/maps/tiles/\",\r\n        \"https://c-data.onegeo.co/maps/tiles/\",\r\n        \"https://d-data.onegeo.co/maps/tiles/\"\r\n        \r\n        //\"https://a.data.osmbuildings.org/0.2/anonymous/tile/\",\r\n        //\"https://b.data.osmbuildings.org/0.2/anonymous/tile/\",\r\n        //\"https://c.data.osmbuildings.org/0.2/anonymous/tile/\",\r\n        //\"https://d.data.osmbuildings.org/0.2/anonymous/tile/\"\r\n    ];\r\n\r\n    protected override stripFilePrefix(original: string): string {\r\n        const prefixLength=35; //51\r\n        const stripped = original.slice(prefixLength);\r\n        //console.log(\"new file URL is: \" + stripped);\r\n        return stripped;\r\n    }\r\n\r\n    public SubmitLoadTileRequest(tile: Tile) {\r\n        if (tile.tileCoords.z > 16) {\r\n            console.error(this.prettyName() + \"Zoom level of: \" + tile.tileCoords.z + \" is too large! This means that buildings won't work!\");\r\n            return;\r\n        }\r\n\r\n        const storedCoords = tile.tileCoords.clone();\r\n\r\n        const url = this.osmBuildingServers[this.serverNum] + storedCoords.z + \"/\" + storedCoords.x + \"/\" + storedCoords.y + \".json\"+\"?token=\"+this.accessToken;\r\n        this.serverNum = (this.serverNum + 1) % this.osmBuildingServers.length; //increment server to use with wrap around\r\n\r\n        const request: BuildingRequest = {\r\n            requestType: BuildingRequestType.LoadTile,\r\n            tile: tile,\r\n            tileCoords: storedCoords,\r\n            epsgType: EPSG_Type.EPSG_4326,\r\n            url: url,\r\n            inProgress: false,\r\n            flipWinding: true\r\n        }\r\n        this.buildingRequests.push(request);\r\n    }       \r\n}\r\n\r\n"]}