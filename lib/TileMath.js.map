{"version":3,"file":"TileMath.js","sourceRoot":"","sources":["../src/TileMath.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AAC9D,OAAO,EAAE,OAAO,EAAE,MAAM,4BAA4B,CAAC;AACrD,OAAO,EAAE,WAAW,EAAE,MAAM,iBAAiB,CAAC;AAI9C,MAAM,CAAN,IAAY,SAGX;AAHD,WAAY,SAAS;IACjB,mDAAS,CAAA;IACT,mDAAS,CAAA;AACb,CAAC,EAHW,SAAS,KAAT,SAAS,QAGpB;AAED,oDAAoD;AACpD,uDAAuD;AACvD,qEAAqE;AACrE,uDAAuD;AAEvD,MAAM,CAAC,OAAO,OAAO,QAAQ;IAEzB,YAAoB,OAA4B;QAA5B,YAAO,GAAP,OAAO,CAAqB;IAChD,CAAC;IAED,0DAA0D;IACnD,WAAW,CAAC,GAAW,EAAE,IAAY,IAAY,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC9G,WAAW,CAAC,GAAW,EAAE,IAAY,IAAY,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAEnM,kBAAkB;IACX,gBAAgB,CAAC,GAAW,EAAE,IAAY,IAAY,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,GAAG,CAAC,GAAG,GAAG,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACzG,gBAAgB,CAAC,GAAW,EAAE,IAAY,IAAY,OAAO,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE9L,SAAS;IACF,WAAW,CAAC,CAAS,EAAE,CAAS;QACnC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;IAC5C,CAAC;IACM,WAAW,CAAC,CAAS,EAAE,CAAS;QACnC,IAAI,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,EAAE,GAAG,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QACnD,OAAO,CAAC,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAC3E,CAAC;IAEM,cAAc,CAAC,UAAkB;QACpC,MAAM,CAAC,GAAC,UAAU,CAAC,CAAC,CAAC;QACrB,MAAM,CAAC,GAAC,UAAU,CAAC,CAAC,CAAC;QACrB,MAAM,IAAI,GAAC,UAAU,CAAC,CAAC,CAAC;QAExB,MAAM,GAAG,GAAC,IAAI,CAAC,WAAW,CAAC,CAAC,EAAC,IAAI,CAAC,CAAC;QACnC,MAAM,GAAG,GAAC,IAAI,CAAC,WAAW,CAAC,CAAC,EAAC,IAAI,CAAC,CAAC;QAEnC,OAAO,IAAI,OAAO,CAAC,GAAG,EAAC,GAAG,CAAC,CAAC;IAChC,CAAC;IAED,mFAAmF;IAC5E,oBAAoB,CAAC,SAAkB;QAE1C,qBAAqB;QACrB,IAAI,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,CAAC;QACxB,IAAI,CAAC,GAAG,SAAS,CAAC,CAAC,0FAA0F;QAC7G,gIAAgI;QAEhI,OAAO,IAAI,OAAO,CACd,CAAC,SAAS,CAAC,CAAC,GAAG,GAAG,CAAC,GAAG,CAAC,EACvB,CAAC,IAAI,CAAC,EAAE,GAAG,GAAG,GAAG,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,GAAG,GAAG,CACtE,CAAC;IACN,CAAC;IAEM,oBAAoB,CAAC,MAAe;QACvC,IAAI,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,GAAG;QACnB,oBAAoB;QACpB,CAAC,GAAG,SAAS,EACb,SAAS,GAAG,kBAAkB,CAAC;QAEnC,mDAAmD;QACnD,+EAA+E;QAC/E,IAAI,QAAQ,GACR,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;QAChF,MAAM,EAAE,GAAY,IAAI,OAAO,CAC3B,CAAC,GAAG,QAAQ,GAAG,GAAG,EAClB,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,IAAI,GAAG,GAAG,GAAG,MAAM,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,CAChE,CAAC;QAEF,iEAAiE;QACjE,IAAI,EAAE,CAAC,CAAC,GAAG,SAAS;YAAE,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC;QACvC,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,SAAS;YAAE,EAAE,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC;QACzC,IAAI,EAAE,CAAC,CAAC,GAAG,SAAS;YAAE,EAAE,CAAC,CAAC,GAAG,SAAS,CAAC;QACvC,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,SAAS;YAAE,EAAE,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC;QAEzC,OAAO,EAAE,CAAC;IACd,CAAC;IAEM,IAAI,CAAC,CAAS;QACjB,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IACtC,CAAC;IAEM,YAAY,CAAC,GAAY,EAAE,IAAe,EAAE,IAAa;QAC5D,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;YACrB,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC7B,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;gBACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;YAChC,CAAC;YAED,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QAC7B,CAAC;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAC1D,OAAO,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;IACxC,CAAC;IAEM,cAAc,CAAC,OAAgB;QAClC,MAAM,CAAC,GAAC,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAC;QACnC,MAAM,MAAM,GAAC,IAAI,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC;IACxC,CAAC;IAEM,YAAY,CAAC,GAAY,EAAE,IAAe,EAAE,IAAa;QAC5D,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;YACrB,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC7B,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;gBACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC7B,CAAC;YAED,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QAC7B,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QAEtD,OAAO,IAAI,OAAO,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,CAAC;IAEM,iBAAiB,CAAC,GAAY,EAAE,IAAe,EAAE,IAAa;QACjE,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;YACrB,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;gBAC7B,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;gBACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;YAC7B,CAAC;YACD,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QAC7B,CAAC;QAED,IAAI,IAAI,IAAI,SAAS,CAAC,SAAS,IAAI,IAAI,IAAI,SAAS,CAAC,SAAS,EAAE,CAAC;YAE7D,IAAI,MAAM,GAAU,GAAG,CAAC;YAExB,IAAG,IAAI,IAAE,SAAS,CAAC,SAAS,EAAE,cAAc;aAC5C,CAAC;gBACG,MAAM,GAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC,wEAAwE;YACnH,CAAC;YAED,MAAM,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YAChD,MAAM,CAAC,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC;YAEhD,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC;aAAM,CAAC;YACJ,OAAO,CAAC,KAAK,CAAC,yBAAyB,CAAC,CAAC;YACzC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC;IACL,CAAC;IAED,wDAAwD;IACxD,eAAe;IACf,eAAe;IACf,wDAAwD;IAEjD,YAAY,CAAC,GAAY;QAC5B,IAAG,IAAI,CAAC,OAAO,KAAG,SAAS,EAAC,CAAC;YACzB,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;YACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QAC9B,CAAC;QAED,MAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,0BAA0B;QAE9D,qDAAqD;QAErD,MAAM,SAAS,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;QACzC,MAAM,SAAS,GAAG,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;QAEzC,2DAA2D;QAE3D,MAAM,gBAAgB,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,GAAG,CAAC;QAC1E,MAAM,gBAAgB,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,GAAG,CAAC;QAE1E,iFAAiF;QAEjF,MAAM,MAAM,GAAG,gBAAgB,GAAG,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;QACrE,MAAM,MAAM,GAAG,gBAAgB,GAAG,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;QAEtE,iEAAiE;QAEhE,OAAO,IAAI,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;IAC1C,CAAC;IAEM,YAAY,CAAC,IAAa;QAC7B,IAAG,IAAI,CAAC,OAAO,KAAG,SAAS,EAAC,CAAC;YACzB,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;YACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QAC9B,CAAC;QAED,MAAM,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,0BAA0B;QAE9D,MAAM,KAAK,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;QAC7B,MAAM,KAAK,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC;QAE7B,MAAM,oBAAoB,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,GAAG,CAAC;QAC9E,MAAM,oBAAoB,GAAG,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,GAAG,GAAG,CAAC;QAE9E,MAAM,QAAQ,GAAG,IAAI,CAAC,CAAC,GAAC,oBAAoB,CAAC;QAC7C,MAAM,QAAQ,GAAG,oBAAoB,GAAC,IAAI,CAAC,CAAC,CAAC,CAAC,yDAAyD;QAEvG,MAAM,sBAAsB,GAAC,QAAQ,GAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;QAC7D,MAAM,sBAAsB,GAAC,QAAQ,GAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC;QAE7D,MAAM,UAAU,GAAC,KAAK,GAAC,sBAAsB,CAAC;QAC9C,MAAM,UAAU,GAAC,KAAK,GAAC,sBAAsB,CAAC;QAE9C,OAAO,IAAI,OAAO,CAAC,UAAU,EAAE,UAAU,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;IAClE,CAAC;IAEM,gBAAgB,CAAC,UAAkB;QACtC,OAAO,CAAC,GAAG,CAAC,sBAAsB,CAAC,CAAC;QACpC,OAAO,CAAC,GAAG,CAAC,sBAAsB,GAAG,UAAU,CAAC,CAAC;QAEjD,MAAM,cAAc,GAAC,UAAU,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC;QACxD,OAAO,CAAC,GAAG,CAAC,2BAA2B,GAAG,cAAc,CAAC,CAAC;QAE1D,MAAM,UAAU,GAAC,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;QACrD,OAAO,CAAC,GAAG,CAAC,aAAa,GAAG,UAAU,CAAC,CAAC;QAExC,MAAM,cAAc,GAAC,UAAU,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC;QACxD,OAAO,CAAC,GAAG,CAAC,2BAA2B,GAAG,cAAc,CAAC,CAAC;QAE1D,MAAM,QAAQ,GAAC,IAAI,CAAC,cAAc,CAAC,cAAc,CAAC,CAAC;QACnD,OAAO,CAAC,GAAG,CAAC,aAAa,GAAG,QAAQ,CAAC,CAAC;QAEtC,MAAM,WAAW,GAAG,IAAI,OAAO,CAAC,UAAU,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,qDAAqD;QAC1I,OAAO,CAAC,GAAG,CAAC,mBAAmB,GAAG,WAAW,CAAC,CAAC;QAC/C,OAAO,WAAW,CAAC;IACvB,CAAC;IAED;;;;;;;;;;;;OAYG;IAEH,iDAAiD;IACjD,yCAAyC;IAClC,0BAA0B,CAAC,GAAW,EAAE,IAAY;QACvD,IAAI,IAAI,IAAI,CAAC,EAAE,CAAC;YACZ,OAAO,CAAC,GAAG,CAAC,4BAA4B,CAAC,CAAC;YAC1C,OAAO,CAAC,CAAC;QACb,CAAC;QACD,OAAO,CAAC,GAAG,CAAC,wCAAwC,GAAG,GAAG,CAAC,CAAC;QAE5D,MAAM,CAAC,GAAG,YAAY,CAAC;QACvB,MAAM,UAAU,GAAG,GAAG,GAAG,IAAI,CAAC,EAAE,GAAG,KAAK,CAAC;QACzC,OAAO,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,oBAAoB;IAC7E,CAAC;IAEM,iBAAiB,CAAC,GAAY,EAAE,IAAe,EAAE,IAAa;QACjE,IAAI,IAAI,CAAC,OAAO,KAAK,SAAS,EAAE,CAAC;YAC7B,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;YACvC,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC;QAED,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;YACrB,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;QAC7B,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,6BAA6B,GAAG,GAAG,CAAC,CAAC;QAEjD,IAAI,UAAU,GAAG,IAAI,CAAC,YAAY,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;QACpD,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,UAAU,CAAC,CAAC;QAE1C,UAAU,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,uCAAuC;QAChG,UAAU,CAAC,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QAExD,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,UAAU,CAAC,CAAC;QAE1C,OAAO,UAAU,CAAC;IACtB,CAAC;IAEM,gBAAgB;QACnB,IAAG,IAAI,CAAC,OAAO,KAAG,SAAS,EAAC,CAAC;YACzB,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;YACvC,OAAO,CAAC,CAAC;QACb,CAAC;QAED,MAAM,UAAU,GAAG,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACnG,OAAO,CAAC,GAAG,CAAC,qCAAqC,GAAG,UAAU,CAAC,CAAC;QAEhE,MAAM,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,0CAA0C;QAE1F,OAAO,CAAC,GAAG,CAAC,mCAAmC,GAAG,eAAe,CAAC,CAAC;QAEnE,MAAM,MAAM,GAAG,eAAe,GAAG,UAAU,CAAC;QAC5C,OAAO,CAAC,GAAG,CAAC,oDAAoD,GAAG,MAAM,CAAC,CAAC;QAE3E,OAAO,MAAM,CAAC;IAClB,CAAC;IAEM,YAAY,CAAC,QAAiB;QACjC,IAAG,IAAI,CAAC,OAAO,KAAG,SAAS,EAAC,CAAC;YACzB,OAAO,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;YACvC,OAAO,SAAS,CAAC;QACrB,CAAC;QAED,MAAM,aAAa,GAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAC,QAAQ,CAAC,CAAC,0FAA0F;QAC/I,MAAM,MAAM,GAAC,IAAI,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,EAAC,CAAC,EAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,CAAC,CAAC;QAClF,MAAM,MAAM,GAAC,IAAI,OAAO,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,EAAC,CAAC,EAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,GAAC,GAAG,CAAC,CAAC;QAEpF,IAAI,mBAAmB,GAAC,MAAM,CAAC,iBAAiB,CAAC;QACjD,IAAI,WAAW,GAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;QAEzC,KAAK,MAAM,CAAC,IAAI,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,CAAC;YACpC,MAAM,EAAE,GAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC;YACzB,MAAM,IAAI,GAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC1B,MAAM,IAAI,GAAC,EAAE,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;YAC1B,MAAM,OAAO,GAAc,IAAI,WAAW,CAAC,IAAI,EAAC,IAAI,CAAC,CAAC;YACtD,uEAAuE;YAEvE,IAAG,OAAO,CAAC,eAAe,CAAC,QAAQ,CAAC,EAAC,CAAC;gBAClC,8DAA8D;gBAC9D,OAAO,CAAC,CAAC;YACb,CAAC;YAED,MAAM,IAAI,GAAG,OAAO,CAAC,QAAQ,CAAC,EAAE,EAAE,QAAQ,CAAC,CAAC;YAC5C,IAAI,IAAI,GAAG,mBAAmB,EAAE,CAAC;gBAC7B,WAAW,GAAG,CAAC,CAAC;YACpB,CAAC;QACL,CAAC;QAED,OAAO,CAAC,GAAG,CAAC,+DAA+D,CAAC,CAAC;QAC7E,OAAO,WAAW,CAAC,CAAC,oEAAoE;IAC5F,CAAC;IAEM,WAAW;QACd,2BAA2B;QAC3B,4GAA4G;QAE5G,MAAM,MAAM,GAAG,IAAI,CAAC;QACpB,MAAM,aAAa,GAAG,GAAG,CAAC;QAC1B,MAAM,WAAW,GAAG,gEAAgE,CAAC;QACrF,4DAA4D;QAC5D,IAAI,iBAAiB,GAAG,EAAE,CAAC;QAC3B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,EAAE,EAAE,CAAC,EAAE,EAAE,CAAC;YAC1B,iBAAiB,IAAI,WAAW,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,CAAC,CAAC;QACrE,CAAC;QAED,IAAI,QAAQ,GAAW,CAAC,aAAa,EAAE,MAAM,EAAE,iBAAiB,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;QAC3E,OAAO,CAAC,GAAG,CAAC,uBAAuB,GAAG,QAAQ,CAAC,CAAC;QAEhD,OAAO,QAAQ,CAAC;IACpB,CAAC;IAED,oFAAoF;IACpF,wDAAwD;IACxD,4CAA4C;IAC5C,4CAA4C;IACrC,sBAAsB,CAAC,EAAW,EAAE,EAAW,EAAE,EAAW,EAAE,EAAW;QAE5E,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QACxB,MAAM,EAAE,GAAW,EAAE,CAAC,CAAC,CAAC;QAExB,6CAA6C;QAC7C,IAAI,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,IAAI,CAAC,EAAE,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,CAAC,EAAE,CAAC;YACvD,OAAO,KAAK,CAAA;QAChB,CAAC;QAED,MAAM,WAAW,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,CAAA;QAEnE,qBAAqB;QACrB,IAAI,WAAW,KAAK,CAAC,EAAE,CAAC;YACpB,OAAO,KAAK,CAAA;QAChB,CAAC;QAED,IAAI,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,WAAW,CAAA;QACtE,IAAI,EAAE,GAAG,CAAC,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC,GAAG,WAAW,CAAA;QAEtE,yCAAyC;QACzC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,IAAI,EAAE,GAAG,CAAC,EAAE,CAAC;YACvC,OAAO,KAAK,CAAC;QACjB,CAAC;QAED,mEAAmE;QACnE,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAC5B,IAAI,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,EAAE,GAAG,EAAE,CAAC,CAAC;QAE5B,OAAO,IAAI,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAA;IAC5B,CAAC;IAEM,QAAQ,CAAC,CAAU;QACtB,OAAO,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAChC,CAAC;IAEM,QAAQ,CAAC,CAAU;QACtB,OAAO,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,EAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAClC,CAAC;CACJ","sourcesContent":["import { Vector2, Vector4 } from \"@babylonjs/core/Maths/math\";\r\nimport { Vector3 } from \"@babylonjs/core/Maths/math\";\r\nimport { BoundingBox } from \"@babylonjs/core\";\r\nimport Tile from './Tile';\r\nimport TileSet from \"./TileSet\";\r\n\r\nexport enum EPSG_Type{\r\n    EPSG_3857,\r\n    EPSG_4326\r\n}\r\n\r\n// There are 3 main coordinate systems we deal with:\r\n// EPSG - could be lon,lat (4326) or webmercator (3857)\r\n// Tile - refers to specific tiling of basemap (based on zoom levels)\r\n// Game - the game engine coordinates used in babylonJS\r\n\r\nexport default class TileMath {\r\n\r\n    constructor(private tileSet: TileSet | undefined) {\r\n    }\r\n\r\n    //https://wiki.openstreetmap.org/wiki/Slippy_map_tilenames\r\n    public lon_to_tile(lon: number, zoom: number): number { return (Math.floor((lon + 180) / 360 * Math.pow(2, zoom))); }\r\n    public lat_to_tile(lat: number, zoom: number): number { return (Math.floor((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom))); }\r\n\r\n    //without rounding\r\n    public lon_to_tileExact(lon: number, zoom: number): number { return (((lon + 180) / 360 * Math.pow(2, zoom))); }\r\n    public lat_to_tileExact(lat: number, zoom: number): number { return (((1 - Math.log(Math.tan(lat * Math.PI / 180) + 1 / Math.cos(lat * Math.PI / 180)) / Math.PI) / 2 * Math.pow(2, zoom))); }\r\n\r\n    //inverse\r\n    public tile_to_lon(x: number, z: number): number {\r\n        return (x / Math.pow(2, z) * 360 - 180);\r\n    }\r\n    public tile_to_lat(y: number, z: number): number {\r\n        var n = Math.PI - 2 * Math.PI * y / Math.pow(2, z);\r\n        return (180 / Math.PI * Math.atan(0.5 * (Math.exp(n) - Math.exp(-n))));\r\n    }\r\n\r\n    public tile_to_lonlat(tileCoords:Vector3):Vector2{\r\n        const x=tileCoords.x;\r\n        const y=tileCoords.y;\r\n        const zoom=tileCoords.z;\r\n\r\n        const lon=this.tile_to_lon(x,zoom);\r\n        const lat=this.tile_to_lat(y,zoom);\r\n\r\n        return new Vector2(lon,lat);\r\n    }\r\n\r\n    //from https://github.com/Turfjs/turf/blob/master/packages/turf-projection/index.ts\r\n    public epsg3857_to_Epsg4326(coord3857: Vector2) {\r\n\r\n        // 900913 properties.\r\n        var R2D = 180 / Math.PI;\r\n        var A = 6378137.0; //DJZ - this seems to be the equatorial radius? https://en.wikipedia.org/wiki/Earth_radius\r\n        //var A = 6371008.8; //this is what maptiler uses: https://github.com/maptiler/maptiler-client-js/blob/main/src/services/math.ts\r\n\r\n        return new Vector2(\r\n            (coord3857.x * R2D) / A,\r\n            (Math.PI * 0.5 - 2.0 * Math.atan(Math.exp(-coord3857.y / A))) * R2D\r\n        );\r\n    } \r\n\r\n    public epsg4326_to_Epsg3857(lonLat: Vector2) {\r\n        var D2R = Math.PI / 180,\r\n            // 900913 properties\r\n            A = 6378137.0,\r\n            MAXEXTENT = 20037508.342789244;\r\n\r\n        // compensate longitudes passing the 180th meridian\r\n        // from https://github.com/proj4js/proj4js/blob/master/lib/common/adjust_lon.js\r\n        var adjusted =\r\n            Math.abs(lonLat.x) <= 180 ? lonLat.x : lonLat.x - this.sign(lonLat.x) * 360;\r\n        const xy: Vector2 = new Vector2(\r\n            A * adjusted * D2R,\r\n            A * Math.log(Math.tan(Math.PI * 0.25 + 0.5 * lonLat.y * D2R)),\r\n        );\r\n\r\n        // if xy value is beyond maxextent (e.g. poles), return maxextent\r\n        if (xy.x > MAXEXTENT) xy.x = MAXEXTENT;\r\n        if (xy.x < -MAXEXTENT) xy.x = -MAXEXTENT;\r\n        if (xy.y > MAXEXTENT) xy.y = MAXEXTENT;\r\n        if (xy.y < -MAXEXTENT) xy.y = -MAXEXTENT;\r\n\r\n        return xy;\r\n    }\r\n\r\n    public sign(x: number): number {\r\n        return x < 0 ? -1 : x > 0 ? 1 : 0;\r\n    }\r\n\r\n    public EPSG_to_Game(pos: Vector2, epsg: EPSG_Type, zoom?: number): Vector3 {\r\n        if (zoom === undefined) {\r\n            if (this.tileSet === undefined) {\r\n                console.error(\"tileSet is undefined!\");\r\n                return new Vector3(0, 0, 0);\r\n            }\r\n\r\n            zoom = this.tileSet.zoom;\r\n        }\r\n\r\n        const exactTile = this.EPSG_to_TileExact(pos, epsg, zoom);\r\n        return this.Tile_to_Game(exactTile);\r\n    }\r\n\r\n    public Game_to_LonLat(gamePos: Vector3){\r\n        const t=this.Game_to_Tile(gamePos); \r\n        const lonlat=this.tile_to_lonlat(t);\r\n    }\r\n\r\n    public EPSG_to_Tile(pos: Vector2, epsg: EPSG_Type, zoom?: number): Vector2 {\r\n        if (zoom === undefined) {\r\n            if (this.tileSet === undefined) {\r\n                console.error(\"tileSet is undefined!\");\r\n                return new Vector2(0, 0);\r\n            }\r\n\r\n            zoom = this.tileSet.zoom;\r\n        }\r\n\r\n        const exact = this.EPSG_to_TileExact(pos, epsg, zoom);\r\n\r\n        return new Vector2(Math.floor(exact.x), Math.floor(exact.y));\r\n    }   \r\n    \r\n    public EPSG_to_TileExact(pos: Vector2, epsg: EPSG_Type, zoom?: number): Vector2 {\r\n        if (zoom === undefined) {\r\n            if (this.tileSet === undefined) {\r\n                console.error(\"tileSet is undefined!\");\r\n                return new Vector2(0, 0);\r\n            }\r\n            zoom = this.tileSet.zoom;\r\n        }\r\n\r\n        if (epsg == EPSG_Type.EPSG_4326 || epsg == EPSG_Type.EPSG_3857) {\r\n\r\n            let lonLat: Vector2=pos;\r\n\r\n            if(epsg==EPSG_Type.EPSG_3857) //if in meters\r\n            {\r\n                lonLat=this.epsg3857_to_Epsg4326(pos); //lets just get everything into 4326 (lat/lon), and then convert to tile\r\n            }\r\n\r\n            const x = this.lon_to_tileExact(lonLat.x, zoom);\r\n            const y = this.lat_to_tileExact(lonLat.y, zoom);\r\n\r\n            return new Vector2(x, y);\r\n        } else {\r\n            console.error(\"unknown projection type\");\r\n            return new Vector2(0, 0);\r\n        }\r\n    }    \r\n\r\n    ////////////////////////////////////////////////////////\r\n    // Tile to Game\r\n    // Game to Tile\r\n    ////////////////////////////////////////////////////////\r\n\r\n    public Tile_to_Game(pos: Vector2): Vector3 {\r\n        if(this.tileSet===undefined){\r\n            console.error(\"tileSet is undefined!\");\r\n            return new Vector3(0,0,0);\r\n        }\r\n\r\n        const t = this.tileSet.ourTiles[0]; //just grab the first tile\r\n\r\n        //console.log(\"corner tile coords: \" + t.tileCoords);\r\n\r\n        const tileDiffX = pos.x - t.tileCoords.x;\r\n        const tileDiffY = pos.y - t.tileCoords.y;\r\n\r\n        //console.log(\"tile diff: \" + tileDiffX + \" \" + tileDiffY);\r\n\r\n        const upperLeftCornerX = t.mesh.position.x - this.tileSet.tileWidth * 0.5;\r\n        const upperLeftCornerY = t.mesh.position.z + this.tileSet.tileWidth * 0.5;\r\n\r\n        //console.log(\"lower left corner: \" + upperLeftCornerX + \" \" + upperLeftCornerY);\r\n\r\n        const xFixed = upperLeftCornerX + tileDiffX * this.tileSet.tileWidth;\r\n        const yFixed = upperLeftCornerY - tileDiffY * this.tileSet.tileWidth;\r\n\r\n       // console.log(\"world position: \" + xFixed +\" \" + yFixed);       \r\n\r\n        return new Vector3(xFixed, 0, yFixed);\r\n    }\r\n\r\n    public Game_to_Tile(gPos: Vector3): Vector3 {\r\n        if(this.tileSet===undefined){\r\n            console.error(\"tileSet is undefined!\");\r\n            return new Vector3(0,0,0);\r\n        }\r\n\r\n        const t = this.tileSet.ourTiles[0]; //just grab the first tile\r\n\r\n        const tileX = t.tileCoords.x;\r\n        const tileY = t.tileCoords.y;\r\n\r\n        const lowerLeftCornerGameX = t.mesh.position.x - this.tileSet.tileWidth * 0.5;\r\n        const lowerLeftCornerGameY = t.mesh.position.z + this.tileSet.tileWidth * 0.5;\r\n \r\n        const posDiffX = gPos.x-lowerLeftCornerGameX;\r\n        const posDiffY = lowerLeftCornerGameY-gPos.z; //or should this be flipped? [NOT CONFIDENT IN THIS CALC]\r\n \r\n        const diffInTileCoordinatesX=posDiffX/this.tileSet.tileWidth;\r\n        const diffinTileCoordinatesY=posDiffY/this.tileSet.tileWidth;\r\n\r\n        const finalTileX=tileX+diffInTileCoordinatesX;\r\n        const finalTileY=tileY+diffinTileCoordinatesY;\r\n\r\n        return new Vector3(finalTileX, finalTileY, this.tileSet.zoom);\r\n    }\r\n\r\n    public computeBBOX_4326(tileCoords:Vector3): Vector4{\r\n        console.log(\"In computeBBOX_4326!\");\r\n        console.log(\"   looking at tile: \" + tileCoords);\r\n    \r\n        const tileBottomLeft=tileCoords.add(new Vector3(0,1,0));\r\n        console.log(\"   proposed bottom left: \" + tileBottomLeft);\r\n\r\n        const bottomLeft=this.tile_to_lonlat(tileBottomLeft);\r\n        console.log(\"   result: \" + bottomLeft);\r\n\r\n        const tileUpperRight=tileCoords.add(new Vector3(1,0,0));\r\n        console.log(\"   proposed upper right: \" + tileUpperRight);\r\n\r\n        const topRight=this.tile_to_lonlat(tileUpperRight);\r\n        console.log(\"   result: \" + topRight);\r\n\r\n        const finalResult = new Vector4(bottomLeft.y, bottomLeft.x, topRight.y, topRight.x); //note the swapped y,x and to get lat,lon ordering   \r\n        console.log(\"   final result: \" + finalResult);\r\n        return finalResult;\r\n    }\r\n\r\n    /*\r\n    public computeBBOX_3857(tileCoords: Vector3): Vector4 {\r\n        const answer4326 = this.computeBBOX_4326(tileCoords);\r\n\r\n        const firstPair = new Vector2(answer4326.y, answer4326.x); //flip back to lon,lat\r\n        const secondPair = new Vector2(answer4326.w, answer4326.z);\r\n\r\n        const fixedFirst = this.epsg4326toEpsg3857(firstPair);\r\n        const fixedSecond = this.epsg4326toEpsg3857(secondPair);\r\n\r\n        const finalResult = new Vector4(fixedFirst.x, fixedFirst.y, fixedSecond.x, fixedSecond.y);    \r\n        return finalResult;\r\n    }*/\r\n\r\n    //https://wiki.openstreetmap.org/wiki/Zoom_levels\r\n    //Stile = C ∙ cos(latitude) / 2^zoomlevel\r\n    public computeTileRealWidthMeters(lat: number, zoom: number): number {\r\n        if (zoom == 0) {\r\n            console.log(\"ERROR: zoom not setup yet!\");\r\n            return 0;\r\n        }\r\n        console.log(\"tryign to compute tile width for lat: \" + lat);\r\n\r\n        const C = 40075016.686;\r\n        const latRadians = lat * Math.PI / 180.0;\r\n        return C * Math.cos(latRadians) / Math.pow(2, zoom); //seems to need abs?\r\n    }\r\n\r\n    public computeCornerTile(pos: Vector2, epsg: EPSG_Type, zoom?: number): Vector2 {\r\n        if (this.tileSet === undefined) {\r\n            console.error(\"tileSet is undefined!\");\r\n            return new Vector2(0, 0);\r\n        }\r\n\r\n        if (zoom === undefined) {\r\n            zoom = this.tileSet.zoom;\r\n        }\r\n\r\n        console.log(\"computing corner tile for: \" + pos);\r\n\r\n        let cornerTile = this.EPSG_to_Tile(pos, epsg, zoom);\r\n        console.log(\"center tile: \" + cornerTile);\r\n\r\n        cornerTile.x -= Math.floor(this.tileSet.numTiles.x / 2); //use floor to handle odd tileset sizes\r\n        cornerTile.y += Math.floor(this.tileSet.numTiles.y / 2);\r\n\r\n        console.log(\"corner tile: \" + cornerTile);\r\n\r\n        return cornerTile;\r\n    }\r\n\r\n    public computeTileScale(): number {\r\n        if(this.tileSet===undefined){\r\n            console.error(\"tileSet is undefined!\");\r\n            return 0; \r\n        }\r\n\r\n        const tileMeters = this.computeTileRealWidthMeters(this.tileSet.centerCoords.y, this.tileSet.zoom);\r\n        console.log(\"tile (real world) width in meters: \" + tileMeters);\r\n\r\n        const tileWorldMeters = this.tileSet.tileWidth; //passed in a parameter in the constructor\r\n\r\n        console.log(\"tile (in game) width in meteres: \" + tileWorldMeters);\r\n\r\n        const result = tileWorldMeters / tileMeters;\r\n        console.log(\"scale of tile (in game) (1.0 would be true size): \" + result);\r\n\r\n        return result;\r\n    }\r\n\r\n    public findBestTile(position: Vector3): Tile | undefined{\r\n        if(this.tileSet===undefined){\r\n            console.error(\"tileSet is undefined!\");\r\n            return undefined;\r\n        }\r\n\r\n        const tileHalfWidth=this.tileSet.tileWidth*0.500001; //make bounding box just a bit bigger, in the off chance something lands right on the line\r\n        const addMax=new Vector3(this.tileSet.tileWidth*0.5,0,this.tileSet.tileWidth*0.5);\r\n        const addMin=new Vector3(-this.tileSet.tileWidth*0.5,0,-this.tileSet.tileWidth*0.5);\r\n\r\n        let closestTileDistance=Number.POSITIVE_INFINITY;\r\n        let closestTile=this.tileSet.ourTiles[0];\r\n\r\n        for (const t of this.tileSet.ourTiles) {\r\n            const tp=t.mesh.position;\r\n            const tMax=tp.add(addMax);\r\n            const tMin=tp.add(addMin);\r\n            const tileBox: BoundingBox=new BoundingBox(tMin,tMax);   \r\n            //console.log(\"box: \" + tileBox.center + \" \" + tileBox.centerWorld);   \r\n\r\n            if(tileBox.intersectsPoint(position)){\r\n                //console.log(\"found a tile that can contain this building!\");\r\n                return t;\r\n            }\r\n\r\n            const dist = Vector3.Distance(tp, position);\r\n            if (dist < closestTileDistance) {\r\n                closestTile = t;\r\n            }\r\n        }\r\n\r\n        console.log(\"couldn't find a tile for this building. choosing closest tile\");\r\n        return closestTile; //position wasn't inside tile, so we will send back the closest tile\r\n    }\r\n\r\n    public generateSKU(): string {\r\n        //sku code generation from:\r\n        //https://github.com/mapbox/mapbox-gl-js/blob/992514ac5471c1231d8a1951bc6752a65aa9e3e6/src/util/sku_token.js\r\n\r\n        const SKU_ID = '01';\r\n        const TOKEN_VERSION = '1';\r\n        const base62chars = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n        // sessionRandomizer is a randomized 10-digit base-62 number\r\n        let sessionRandomizer = '';\r\n        for (let i = 0; i < 10; i++) {\r\n            sessionRandomizer += base62chars[Math.floor(Math.random() * 62)];\r\n        }\r\n\r\n        let skuToken: string = [TOKEN_VERSION, SKU_ID, sessionRandomizer].join('');\r\n        console.log(\"computed mapbox sku: \" + skuToken);\r\n\r\n        return skuToken;\r\n    }\r\n\r\n    // line intercept math by Paul Bourke http://paulbourke.net/geometry/pointlineplane/\r\n    // Determine the intersection point of two line segments\r\n    // Return FALSE if the lines don't intersect\r\n    // updated by DJZ for TypeScript / BabylonJS\r\n    public line_segment_intersect(p1: Vector2, p2: Vector2, p3: Vector2, p4: Vector2): Vector2 | false {\r\n\r\n        const x1: number = p1.x;\r\n        const y1: number = p1.y;\r\n        const x2: number = p2.x;\r\n        const y2: number = p2.y;\r\n        const x3: number = p3.x;\r\n        const y3: number = p3.y;\r\n        const x4: number = p4.x;\r\n        const y4: number = p4.y;\r\n\r\n        // Check if none of the lines are of length 0\r\n        if ((x1 === x2 && y1 === y2) || (x3 === x4 && y3 === y4)) {\r\n            return false\r\n        }\r\n\r\n        const denominator = ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1))\r\n\r\n        // Lines are parallel\r\n        if (denominator === 0) {\r\n            return false\r\n        }\r\n\r\n        let ua = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) / denominator\r\n        let ub = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) / denominator\r\n\r\n        // is the intersection along the segments\r\n        if (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\r\n            return false;\r\n        }\r\n\r\n        // Return a object with the x and y coordinates of the intersection\r\n        let x = x1 + ua * (x2 - x1);\r\n        let y = y1 + ua * (y2 - y1);\r\n\r\n        return new Vector2(x, y)\r\n    }\r\n\r\n    public v3_to_v2(v: Vector3): Vector2{\r\n        return new Vector2(v.x,v.z);\r\n    }\r\n\r\n    public v2_to_v3(v: Vector2): Vector3{\r\n        return new Vector3(v.x,0,v.y);\r\n    }\r\n}\r\n"]}